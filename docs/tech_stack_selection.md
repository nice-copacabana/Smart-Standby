# 技术选型报告 (Technical Selection Report) - 2.0 AI快速开发版

## 1. 项目背景与目标
**项目名称**：Windows 智能睡眠守护工具 (Windows Sleep Guardian)
**核心目标**：快速解决Windows高性能笔记本（如联想Y9000P）合盖无法睡眠、唤醒黑屏、发热耗电等痛点。
**开发理念**：**AI全栈快速开发**。在保证核心功能（高性能、系统级权限）的前提下，优先选择开发效率高、AI代码生成质量好的技术栈，压缩开发周期。

## 2. 核心技术栈 (Core Tech Stack)

### 2.1 编程语言：C# (.NET 8)
- **选择理由**：
  - **AI 友好**：LLM 对 C# / .NET 的训练数据极为丰富，生成的代码质量高，错误率低。
  - **系统集成**：原生支持 P/Invoke 和 COM 组件，便于调用 `powercfg`、WMI、Windows事件日志等底层能力。
  - **性能**：.NET 8 在启动速度和内存占用上已非常优秀，完全满足常驻工具需求。

### 2.2 UI 框架：WinUI 3 (Windows App SDK)
- **选择理由**：
  - **现代化**：无需额外设计即可获得 Windows 11 原生外观（圆角、Mica材质），节省 UI 设计时间。
  - **组件丰富**：内置 DataGrid, Charts (配合 LiveCharts2) 等控件，适合构建“仪表盘”和“排行榜”。
  - **开发效率**：XAML 声明式 UI 适合 AI 快速生成布局代码。

### 2.3 数据与脚本交互
- **PowerShell集成**：使用 `System.Management.Automation` 直接在 C# 中执行 PowerShell 脚本。
  - **理由**：`powercfg`, `Get-WinEvent`, `Get-WmiObject` 等系统命令通过 PS 调用比纯 C# API 封装更快捷、更灵活（AI生成的脚本也更准确）。
- **SQLite**：本地单文件数据库。
  - **理由**：零配置，适合存储结构化的历史日志和黑名单配置。

## 3. 架构模式：单体 + 辅助服务
为了响应“快速开发”，简化复杂的 IPC 通信：
- **主程序 (Admin)**：UI 和 核心逻辑（监控、拦截）运行在同一个提权进程中（需要管理员权限运行）。
  - **优势**：省去进程间通信开发成本，所有模块内存共享，开发极快。
- **开机自启辅助**：一个极小的无 UI 进程，仅用于检测唤醒事件，必要时拉起主程序。

## 4. 关键技术点预研

| 功能点 | 实现方案 | AI生成的复杂度 |
| :--- | :--- | :--- |
| **阻塞检测** | 封装 `powercfg /requests` 输出解析 (Regex) | 低 (常用代码模式) |
| **进程管理** | `System.Diagnostics.Process` + `Kill()` | 极低 |
| **事件日志** | `EventLogQuery` 查询 System 分区 (ID 1, 42, 6005...) | 中 (需测试查询语句) |
| **图表展示** | `LiveChartsCore.SkiaSharpView.WinUI` | 中 (UI绑定需微调) |

## 5. 结论
采用 **.NET 8 (C#) + WinUI 3 + SQLite + PowerShell混编** 的技术栈。
此方案充分利用 .NET 生态的“开箱即用”特性，配合 AI 强大的代码生成能力，能够以最快速度将文档中的 5 大核心模块（检测器、管理器、控制器、记录仪、面板）落地为可用的产品。
