<Page
    x:Class="SmartStandby.Views.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:SmartStandby.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    x:Name="RootPage">

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" Padding="24">
        <StackPanel Spacing="20">
            <TextBlock Text="{StaticResource SettingsHeader}" Style="{ThemeResource TitleTextBlockStyle}"/>

            <!-- Toggles -->
            <StackPanel Spacing="10">
                <TextBlock Text="{StaticResource ConfigGeneral}" Style="{ThemeResource SubtitleTextBlockStyle}"/>
                <ToggleSwitch Header="{StaticResource ConfigNetwork}" IsOn="{Binding EnableNetworkDisconnect}" OnContent="Enabled" OffContent="Disabled"/>
                <ToggleSwitch Header="{StaticResource ConfigStartup}" IsOn="{Binding EnableRunOnStartup}" OnContent="Enabled" OffContent="Disabled"/>
                <ToggleSwitch Header="{StaticResource ConfigTdr}" IsOn="{Binding EnableTdrPatch}" OnContent="Enabled" OffContent="Disabled"/>
                
                <StackPanel Spacing="4" Margin="0,10,0,0">
                    <TextBlock Text="{StaticResource ConfigThreshold}" Style="{ThemeResource BodyTextBlockStyle}"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Slider Minimum="0.5" Maximum="20.0" StepFrequency="0.5" Value="{Binding BatteryDrainThreshold, Mode=TwoWay}"/>
                        <TextBlock Grid.Column="1" Text="{Binding BatteryDrainThreshold, StringFormat='{}{0:F1}%'}" VerticalAlignment="Center" Margin="12,0,0,0" Width="40"/>
                    </Grid>
                    <TextBlock Text="Sessions with drain rate above this will be flagged as Warning." Foreground="Gray" FontSize="11"/>
                </StackPanel>
            </StackPanel>

            <!-- Whitelist -->
            <StackPanel Spacing="10">
                <TextBlock Text="{StaticResource WhitelistHeader}" Style="{ThemeResource SubtitleTextBlockStyle}"/>
                <TextBlock Text="Processes in this list will NOT be killed." Foreground="Gray" FontSize="12"/>
                
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <TextBox Text="{Binding NewProcessName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PlaceholderText="e.g. steam.exe" Width="200"/>
                    <Button Command="{Binding AddWhitelistCommand}" Content="Add"/>
                </StackPanel>

                <ListView ItemsSource="{Binding WhitelistProcesses}" Height="200" BorderThickness="1" BorderBrush="#33000000" CornerRadius="4">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                <Button Grid.Column="1" Command="{Binding ElementName=RootPage, Path=ViewModel.RemoveWhitelistCommand}" CommandParameter="{Binding}" Content="Remove" FontSize="10" Margin="0,0,10,0"/>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </StackPanel>

            <!-- About & Updates -->
            <StackPanel Spacing="10">
                <TextBlock Text="{StaticResource AboutHeader}" Style="{ThemeResource SubtitleTextBlockStyle}"/>
                <StackPanel Orientation="Horizontal" Spacing="20" VerticalAlignment="Center">
                    <TextBlock Text="Current Version:" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding CurrentVersion}" FontWeight="Bold" VerticalAlignment="Center"/>
                    <Button Command="{Binding CheckForUpdatesCommand}" Content="Check for Updates" IsEnabled="{Binding IsCheckingForUpdates, Converter={StaticResource InverseBooleanConverter}}" />
                </StackPanel>
                <TextBlock Text="{Binding UpdateStatusText}" FontSize="12" Foreground="Gray" Visibility="{Binding UpdateStatusText, Converter={StaticResource StringVisibilityConverter}}" />
                
                <Button Content="Download Latest Version" 
                        Visibility="{Binding IsUpdateAvailable, Converter={StaticResource BooleanToVisibilityConverter}}"
                        HorizontalAlignment="Left"
                        Style="{StaticResource AccentButtonStyle}"
                        Margin="0,5,0,0"/>
            </StackPanel>

            <!-- Actions -->
            <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Right">
                <Button Command="{Binding OpenLogsFolderCommand}" Content="{StaticResource ButtonOpenLogs}" />
                <Button Command="{Binding ClearHistoryCommand}" Content="{StaticResource ButtonClearHistory}" Foreground="Red" />
                <Button Command="{Binding SaveSettingsCommand}" Content="Save" Style="{StaticResource AccentButtonStyle}"/>
            </StackPanel>
        </StackPanel>
    </Grid>
</Page>
